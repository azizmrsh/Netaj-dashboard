# ุชูุฑูุฑ ุงูููุงุฑูุฉ: ููู Excel ููุงุจู ุงูููุฏ ุงูุญุงูู
## Excel vs Code Comparison Report

**ุชุงุฑูุฎ ุงูููุงุฑูุฉ:** 2025-10-21  
**ุงููููุงุช ุงูููุงุฑูุฉ:**
- ููู Excel: ูุดู ุญุณุงุจ ูุฎุฒูู - ุดุฑูุฉ Al-Gary
- ุงูููุฏ ุงูุญุงูู: CustomerReport.php & CustomerReportExport.php

---

## ๐ ุงูุฌุฒุก ุงูุฃูู: ุชุญููู ููู Excel

### ุจููุฉ ุงูุฌุฏูู ูู Excel:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Netaj Almotatwrah Commercial Company                                    โ
โ ASPHALT 60/70 Bin Card                                                  โ
โ From 1-31 August 2025                                                   โ
โ Customer Name: Al-Gary Company                                          โ
โโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโฌโโโโโโโโโโโโโโค
โ No โ Date     โ Document No  โ Product Name โ Receipts   โ Issues      โ
โ    โ          โ              โ              โ (Qty Ton)  โ (Qty Ton)   โ
โโโโโโผโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโผโโโโโโโโโโโโโโค
โ *  โ *        โ Opening Bal  โ *            โ *          โ *           โ
โ 1  โ 8/2/2025 โ Receipt 0008 โ ASPHALT 60/70โ 26.02      โ             โ
โ 2  โ 8/2/2025 โ Delivery 0006โ PG 76 S-10   โ            โ 25.06       โ
โโโโโโดโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโดโโโโโโโโโโโโโโ

    โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโ
    โ Balance     โ Rate (SAR)   โ Value (SAR)      โ
    โ (Qty Ton)   โ              โ                  โ
    โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโค
    โ 0.00        โ *            โ *                โ
    โ 26.02       โ              โ                  โ
    โ 0.96        โ 115          โ 2881.9           โ
    โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ข ุงูุฌุฒุก ุงูุซุงูู: ุงููุนุงุฏูุงุช ูู Excel

### 1. ูุนุงุฏูุฉ ุญุณุงุจ ุงูุฑุตูุฏ (Balance):
```excel
Balance (G7) = G6 + E7 - F7
```

**ุงูุดุฑุญ:**
- `G6` = ุงูุฑุตูุฏ ุงูุณุงุจู
- `E7` = ุงููููุฉ ุงููุงุฑุฏุฉ (Receipts)
- `F7` = ุงููููุฉ ุงูุตุงุฏุฑุฉ (Issues)
- **ุงูููุทู:** ุงูุฑุตูุฏ ุงูุฌุฏูุฏ = ุงูุฑุตูุฏ ุงูุณุงุจู + ุงููุงุฑุฏ - ุงูุตุงุฏุฑ

**ูุซุงู ูู ุงูุตูุฑุฉ:**
- ุงูุตู 1: Opening Balance = 0.00
- ุงูุตู 2: Receipt 26.02 โ Balance = 0 + 26.02 - 0 = **26.02**
- ุงูุตู 3: Delivery 25.06 โ Balance = 26.02 + 0 - 25.06 = **0.96**

---

### 2. ูุนุงุฏูุฉ ุญุณุงุจ ุงููููุฉ (Value):
```excel
Value (I7) = F7 ร H7
```

**ุงูุดุฑุญ:**
- `F7` = ุงููููุฉ ุงูุตุงุฏุฑุฉ (Issues)
- `H7` = ุงูุณุนุฑ (Rate)
- **ุงูููุทู:** ุงููููุฉ = ุงููููุฉ ุงูุตุงุฏุฑุฉ ร ุงูุณุนุฑ
- **ููุงุญุธุฉ ูุงูุฉ:** ุงููููุฉ ุชูุญุณุจ ููุท ููุตุงุฏุฑุงุช (Deliveries)ุ ููุณ ูููุงุฑุฏุงุช (Receipts)

**ูุซุงู ูู ุงูุตูุฑุฉ:**
- ุงูุตู 3: Issues = 25.06, Rate = 115 โ Value = 25.06 ร 115 = **2881.9**
- ุงูุตู 4: Issues = 24.42, Rate = 115 โ Value = 24.42 ร 115 = **2808.3**

---

### 3. ูุนุงุฏูุงุช ุงูุฌุฏูู ุงูุฎุชุงูู (Summary):

#### ุฅุฌูุงูู ุงููุงุฑุฏุงุช (Total Receipts):
```excel
Total Receipts = SUM(E7:E81)
```
ูู ุงูุตูุฑุฉ: **923.70** ุทู

#### ุฅุฌูุงูู ุงูุตุงุฏุฑุงุช (Total Issues):
```excel
Total Issues = SUM(F7:F81)
```
ูู ุงูุตูุฑุฉ: **934.14** ุทู

#### ุงูุฑุตูุฏ ุงูููุงุฆู (Balance):
```excel
Balance = Total Receipts - Total Issues
Balance = 923.70 - 934.14 = -10.44
```
ูู ุงูุตูุฑุฉ: **-10.44** ุทู (ุฑุตูุฏ ุณุงูุจ)

#### ุฅุฌูุงูู ุงููุจูุบ ูุจู ุงูุถุฑูุจุฉ (Total Amount Before Tax):
```excel
Total Amount Before Tax = SUM(I8:I81)
```
ูู ุงูุตูุฑุฉ: **107426.10** ุฑูุงู

#### ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ (VAT):
```excel
VAT = Total Amount Before Tax ร 15%
VAT = 107426.10 ร 0.15 = 16113.92
```
ูู ุงูุตูุฑุฉ: **16113.92** ุฑูุงู

#### ุฅุฌูุงูู ุงููุจูุบ ุจุนุฏ ุงูุถุฑูุจุฉ (Total Amount After Tax):
```excel
Total Amount After Tax = Total Amount Before Tax + VAT
Total Amount After Tax = 107426.10 + 16113.92 = 123540.02
```
ูู ุงูุตูุฑุฉ: **123540.02** ุฑูุงู

---

## ๐ป ุงูุฌุฒุก ุงูุซุงูุซ: ุงูููุทู ูู ุงูููุฏ ุงูุญุงูู

### ููู: `CustomerReport.php`

#### 1. ุญุณุงุจ ุงูุฑุตูุฏ ุงูุฌุงุฑู (Running Balance):

```php
// ูู ุฏุงูุฉ calculateReportData()
$runningBalance = $openingBalance;

foreach ($transactions as $transaction) {
    $runningBalance += $transaction['receipts'] - $transaction['issues'];
    
    $reportData->push([
        'balance' => $runningBalance,
        // ...
    ]);
}
```

**โ ุงูููุทู ูุทุงุจู ูู Excel:**
- ุงูุฑุตูุฏ ุงูุฌุฏูุฏ = ุงูุฑุตูุฏ ุงูุณุงุจู + ุงููุงุฑุฏุงุช - ุงูุตุงุฏุฑุงุช

---

#### 2. ุญุณุงุจ ุงููููุฉ (Value):

```php
// ูู ุฏุงูุฉ calculateReportData()
$value = $transaction['issues'] > 0 ? $transaction['issues'] * $this->rate : 0;

$reportData->push([
    'rate' => $transaction['issues'] > 0 ? $this->rate : 0,
    'value' => $value,
    // ...
]);
```

**โ ุงูููุทู ูุทุงุจู ูู Excel:**
- ุงููููุฉ = ุงููููุฉ ุงูุตุงุฏุฑุฉ ร ุงูุณุนุฑ
- ุงููููุฉ ุชูุญุณุจ ููุท ููุตุงุฏุฑุงุช

---

#### 3. ุญุณุงุจ ุงูููุฎุต (Summary):

```php
// ูู ุฏุงูุฉ calculateReportData()
$this->totalReceipts = 0;
$this->totalIssues = 0;

foreach ($transactions as $transaction) {
    $this->totalReceipts += $transaction['receipts'];
    $this->totalIssues += $transaction['issues'];
}

$this->finalBalance = $runningBalance;
$this->totalAmountBeforeTax = $this->totalIssues * $this->rate;
$this->vatAmount = $this->totalAmountBeforeTax * 0.15;
$this->totalAmountAfterTax = $this->totalAmountBeforeTax + $this->vatAmount;
```

**โ ุงูููุทู ูุทุงุจู ูู Excel:**
- Total Receipts = ูุฌููุน ุงููุงุฑุฏุงุช
- Total Issues = ูุฌููุน ุงูุตุงุฏุฑุงุช
- Final Balance = ุงูุฑุตูุฏ ุงูุฃุฎูุฑ
- Total Amount Before Tax = ูุฌููุน ุงูุตุงุฏุฑุงุช ร ุงูุณุนุฑ
- VAT = ุงููุจูุบ ูุจู ุงูุถุฑูุจุฉ ร 15%
- Total Amount After Tax = ุงููุจูุบ ูุจู ุงูุถุฑูุจุฉ + ุงูุถุฑูุจุฉ

---

## โ๏ธ ุงูุฌุฒุก ุงูุฑุงุจุน: ุงูููุงุฑูุฉ ูุงููุฑููุงุช

### โ ุงูุชุดุงุจูุงุช (ูุง ูู ูุชุทุงุจู):

| ุงูุนูุตุฑ | Excel | ุงูููุฏ ุงูุญุงูู | ุงูุญุงูุฉ |
|--------|-------|-------------|--------|
| **ูุนุงุฏูุฉ ุงูุฑุตูุฏ** | `G7 = G6 + E7 - F7` | `$runningBalance += receipts - issues` | โ ูุชุทุงุจู |
| **ูุนุงุฏูุฉ ุงููููุฉ** | `I7 = F7 ร H7` | `$value = issues ร rate` | โ ูุชุทุงุจู |
| **ุฅุฌูุงูู ุงููุงุฑุฏุงุช** | `SUM(E7:E81)` | `sum(receipts)` | โ ูุชุทุงุจู |
| **ุฅุฌูุงูู ุงูุตุงุฏุฑุงุช** | `SUM(F7:F81)` | `sum(issues)` | โ ูุชุทุงุจู |
| **ุงูุฑุตูุฏ ุงูููุงุฆู** | `Receipts - Issues` | `$runningBalance` | โ ูุชุทุงุจู |
| **ุถุฑูุจุฉ 15%** | `ร 0.15` | `ร 0.15` | โ ูุชุทุงุจู |
| **ุจููุฉ ุงูุฃุนูุฏุฉ** | 8 ุฃุนูุฏุฉ | 8 ุฃุนูุฏุฉ | โ ูุชุทุงุจู |

---

### โ๏ธ ุงููุฑููุงุช ุงูุฑุฆูุณูุฉ:

#### 1. ุญุณุงุจ ุงููุจูุบ ูุจู ุงูุถุฑูุจุฉ:

| Excel | ุงูููุฏ ุงูุญุงูู |
|-------|-------------|
| `SUM(I8:I81)` - ูุฌููุน ููู ูู ุตู | `Total Issues ร Rate` |
| ูุฌูุน ูู ุงูููู ุงููุฑุฏูุฉ | ูุญุณุจ ุงูุฅุฌูุงูู ูุจุงุดุฑุฉ |

**ุงูุชุญููู:**
- **Excel**: ูุญุณุจ ุงููููุฉ ููู ุตู ุซู ูุฌูุนูุง: `(25.06ร115) + (24.42ร115) + ...`
- **ุงูููุฏ**: ูุฌูุน ุงููููุงุช ุซู ูุถุฑุจ: `(25.06 + 24.42 + ...) ร 115`
- **ุงููุชูุฌุฉ**: โ **ููุณ ุงููุชูุฌุฉ ุฑูุงุถูุงู** (ุฎุงุตูุฉ ุงูุชูุฒูุน)

```
Excel:   (aรr) + (bรr) + (cรr) = 107426.10
Code:    (a + b + c) ร r = 107426.10
Result:  ููุณ ุงููุชูุฌุฉ โ
```

---

#### 2. ุตู ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู (Opening Balance):

| Excel | ุงูููุฏ ุงูุญุงูู |
|-------|-------------|
| ูุธูุฑ ูู ุงูุตู ุงูุฃูู ุฏุงุฆูุงู | ูุธูุฑ ูู ุงูุตู ุงูุฃูู โ |
| ุงูุฑุตูุฏ ููุฏุฎู ูุฏููุงู | ููุฏุฎู ูุฏููุงู ุฃู ููุญุณุจ ูู ุงูุชุงุฑูุฎ ุงูุณุงุจู โ |

**ุงูุชุญููู:**
- โ ุงูููุฏ ูุฏุนู ุฅุฏุฎุงู ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู ูุฏููุงู
- โ ุงูููุฏ ูุฏุนู ุฃูุถุงู ุญุณุงุจ ุงูุฑุตูุฏ ูู ุงูุนูููุงุช ุงูุณุงุจูุฉ (ููุฒุฉ ุฅุถุงููุฉ)

```php
// ูู ุงููุงุฌูุฉ (Form)
Forms\Components\TextInput::make('opening_balance')
    ->label('Opening Balance (ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู)')
    ->numeric()
    ->default(0);

// ูู ุงูููุฏ
$openingBalance = $this->openingBalance; // ููุฏุฎู ูุฏููุงู

// ุฃู ููุญุณุจ ูู ุงูุชุงุฑูุฎ ุงูุณุงุจู
$openingBalance = $this->calculateOpeningBalance($customerId, $beforeDate);
```

---

#### 3. ูุนุฏู ุงูุถุฑูุจุฉ (Tax Rate):

| Excel | ุงูููุฏ ุงูุญุงูู |
|-------|-------------|
| ุซุงุจุช: 15% | ูุงุจู ููุชุบููุฑ ูู ุงููุงุฌูุฉ โ |

**ุงูุชุญููู:**
- Excel: ุงูุถุฑูุจุฉ ุซุงุจุชุฉ 15%
- ุงูููุฏ: ูููู ุชุนุฏูููุง ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู
- **ูุซุงู:** ูููู ูุถุน 0% ุฃู 5% ุฃู 15%

```php
Forms\Components\TextInput::make('tax_rate')
    ->label('Tax Rate (ูุนุฏู ุงูุถุฑูุจุฉ)')
    ->numeric()
    ->default(0)
    ->suffix('%');
```

---

#### 4. ุงูุณุนุฑ (Rate):

| Excel | ุงูููุฏ ุงูุญุงูู |
|-------|-------------|
| ุซุงุจุช: 115 ุฑูุงู ููู ุงูุตููู | ููุฏุฎู ูู ุงููุงุฌูุฉ ูุฑุฉ ูุงุญุฏุฉ |
| ูุธูุฑ ูู ุนููุฏ Rate | ููุทุจู ุนูู ูู ุงูุตุงุฏุฑุงุช |

**โ๏ธ ูุดููุฉ ูุญุชููุฉ ูู ุงูููุฏ:**
```php
// ุงูููุฏ ุงูุญุงูู
$this->rate = ($data['tax_rate'] ?? 0) / 100 + 1;
```

**ุชุญููู ุงููุดููุฉ:**
- ุฅุฐุง ุฃุฏุฎู ุงููุณุชุฎุฏู `tax_rate = 0`
- ุงููุชูุฌุฉ: `rate = 0/100 + 1 = 1`
- **ุงููุดููุฉ:** ุงููุชุบูุฑ `rate` ููุณุชุฎุฏู ูู "ุงูุณุนุฑ ุงูุฃุณุงุณู" ูููุณ "ูุนุฏู ุงูุถุฑูุจุฉ"

**ูู Excel:**
- Rate = 115 (ุงูุณุนุฑ ุงูุฃุณุงุณู)
- Tax = 15% (ูุนุฏู ุงูุถุฑูุจุฉ)
- ูุฐุงู ูููููุงู ูููุตูุงู!

**ุงูุญู ุงูููุชุฑุญ:**
ูุฌุจ ูุตู ููููู "ุงูุณุนุฑ ุงูุฃุณุงุณู" ุนู "ูุนุฏู ุงูุถุฑูุจุฉ":

```php
// ูุฌุจ ุฅุถุงูุฉ ุญูู ูููุตู ููุณุนุฑ ุงูุฃุณุงุณู
Forms\Components\TextInput::make('unit_rate')
    ->label('Unit Rate (ุณุนุฑ ุงููุญุฏุฉ)')
    ->numeric()
    ->default(115)
    ->suffix('SAR');

Forms\Components\TextInput::make('tax_rate')
    ->label('Tax Rate (ูุนุฏู ุงูุถุฑูุจุฉ)')
    ->numeric()
    ->default(15)
    ->suffix('%');

// ูู ุงูุญุณุงุจ
$this->unitRate = $data['unit_rate'] ?? 115;
$this->taxRate = ($data['tax_rate'] ?? 15) / 100;
$this->totalAmountBeforeTax = $this->totalIssues * $this->unitRate;
$this->vatAmount = $this->totalAmountBeforeTax * $this->taxRate;
```

---

#### 5. ุชุฌููุน ุงูููุชุฌุงุช:

| Excel | ุงูููุฏ ุงูุญุงูู |
|-------|-------------|
| ูู ุตู = ููุชุฌ ูุงุญุฏ | ูู ุตู = ูู ููุชุฌุงุช ุงููุณุชูุฏ |
| ุตู ูุงุญุฏ: ASPHALT 60/70 | ุตู ูุงุญุฏ: "Receipt: ASPHALT 60/70, PG 76, ..." |

**ูุซุงู ูู Excel:**
```
Row 2: Receipt Note 0008 | ASPHALT 60/70 | 26.02
```

**ูุซุงู ูู ุงูููุฏ:**
```php
foreach ($receiptDocs as $doc) {
    $totalQty = $doc->receiptDocumentProducts->sum('quantity');
    $products = $doc->receiptDocumentProducts->pluck('product.name')->join(', ');
    
    $transactions->push([
        'product_name' => "Receipt: {$products}",
        'receipts' => $totalQty, // ูุฌููุน ูู ุงูููุชุฌุงุช ูู ุงููุณุชูุฏ
    ]);
}
```

**ุงููุชูุฌุฉ:**
```
Row: Receipt Note 0008 | Receipt: ASPHALT 60/70, Product2, Product3 | 26.02 + 10 + 5 = 41.02
```

**โ๏ธ ุงููุฑู ุงูุฌููุฑู:**
- Excel: ุตู ูุงุญุฏ ููู ููุชุฌ ูู ุงููุณุชูุฏ
- ุงูููุฏ: ุตู ูุงุญุฏ ููู ูุณุชูุฏ (ูุฌูุน ูู ุงูููุชุฌุงุช)

---

## ๐ฏ ุงูุฌุฒุก ุงูุฎุงูุณ: ุงูุชูุตูุงุช

### 1. ุฅุตูุงุญ ููููู Rate vs Tax Rate โ๏ธ **ุนุงุฌู**

**ุงููุดููุฉ ุงูุญุงููุฉ:**
```php
// โ ุฎุทุฃ: ุงุณุชุฎุฏุงู tax_rate ูู rate
$this->rate = ($data['tax_rate'] ?? 0) / 100 + 1;
$value = $transaction['issues'] * $this->rate;
```

**ุงูุญู:**
```php
// โ ุตุญูุญ: ูุตู ุงูุณุนุฑ ุนู ุงูุถุฑูุจุฉ
$this->unitRate = $data['unit_rate'] ?? 115;
$this->taxRate = ($data['tax_rate'] ?? 15) / 100;
$value = $transaction['issues'] * $this->unitRate;
$vatAmount = $totalAmountBeforeTax * $this->taxRate;
```

---

### 2. ุฎูุงุฑ ุนุฑุถ ุงูููุชุฌุงุช ูููุตูุฉ

**ุงููุถุน ุงูุญุงูู:**
- ุงููุณุชูุฏ ุงููุงุญุฏ = ุตู ูุงุญุฏ (ูุฌููุน ูู ุงูููุชุฌุงุช)

**ุงูุฎูุงุฑ ุงูููุชุฑุญ:**
```php
Forms\Components\Toggle::make('separate_products')
    ->label('Show products separately (ุนุฑุถ ุงูููุชุฌุงุช ูููุตูุฉ)')
    ->default(false);

// ูู ุงูููุฏ
if ($this->data['separate_products']) {
    // ุนุฑุถ ูู ููุชุฌ ูู ุตู ูููุตู (ูุซู Excel)
    foreach ($doc->receiptDocumentProducts as $product) {
        $transactions->push([
            'product_name' => $product->product->name,
            'receipts' => $product->quantity,
        ]);
    }
} else {
    // ุนุฑุถ ุงููุณุชูุฏ ูุงููุงู ูู ุตู ูุงุญุฏ (ุงููุถุน ุงูุญุงูู)
}
```

---

### 3. ุฎูุงุฑ ุงูุณุนุฑ ููู ููุชุฌ

**ูู Excel:**
- ูู ุงูุตุงุฏุฑุงุช ููุง ููุณ ุงูุณุนุฑ (115)

**ุงูููุฏ ุงูุญุงูู:**
- ุณุนุฑ ูุงุญุฏ ููู ุงูููุชุฌุงุช

**ุชุญุณูู ููุชุฑุญ:**
```php
// ุฅุฐุง ูุงู ูู ููุชุฌ ูู ุณุนุฑ ูุฎุชูู
if ($product->unit_price) {
    $value = $transaction['issues'] * $product->unit_price;
} else {
    $value = $transaction['issues'] * $this->defaultRate;
}
```

---

### 4. ุชุญุณูู ุตูุบุฉ ุงูุนุฑุถ ูู Excel Export

**ุงููุถุน ุงูุญุงูู ูู `CustomerReportExport.php`:**
```php
public function styles(Worksheet $sheet)
{
    // ูุถูู header ูุนูููุงุช ุงูุดุฑูุฉ
    $sheet->setCellValue('A1', 'Inventory Account Statement - ' . $this->customer->name);
}
```

**ุชุญุณูู ููุชุฑุญ ููุทุงุจูุฉ Excel:**
```php
// ุฅุถุงูุฉ ุงุณู ุงูููุชุฌ ุฅุฐุง ูุงู ุงูุชูุฑูุฑ ูููุชุฌ ูุงุญุฏ
$sheet->setCellValue('A1', 'Netaj Almotatwrah Commercial Company');
$sheet->setCellValue('A2', 'ASPHALT 60/70 Bin Card'); // ุฃู ุงุณู ุงูููุชุฌ
$sheet->setCellValue('A3', 'From ' . $dateFrom . ' To ' . $dateTo);
$sheet->setCellValue('A4', 'Customer Name: ' . $this->customer->name);
```

---

### 5. ุฅุถุงูุฉ ุชุตููุฉ ุญุณุจ ุงูููุชุฌ

**ุบูุฑ ููุฌูุฏ ุญุงููุงู:**
- ุงูุชูุฑูุฑ ูุนุฑุถ ูู ุงูููุชุฌุงุช ููุนููู

**ููุชุฑุญ:**
```php
Forms\Components\Select::make('product_id')
    ->label('Product (optional)')
    ->options(Product::pluck('name', 'id'))
    ->searchable()
    ->nullable();

// ูู ุงูููุฏ
if ($this->data['product_id']) {
    // ุชุตููุฉ ุงูุนูููุงุช ุญุณุจ ุงูููุชุฌ ุงููุญุฏุฏ
}
```

---

## ๐ ุงูุฌุฒุก ุงูุณุงุฏุณ: ุฌุฏูู ุงูููุงุฑูุฉ ุงูุดุงูู

| ุงูููุฒุฉ | Excel | ุงูููุฏ ุงูุญุงูู | ุงูุชุทุงุจู | ุงูููุงุญุธุงุช |
|--------|-------|-------------|---------|-----------|
| **ูุนุงุฏูุฉ ุงูุฑุตูุฏ** | G=G-1+E-F | โ ููุณ ุงูููุทู | โ 100% | ูุชุทุงุจู ุชูุงูุงู |
| **ูุนุงุฏูุฉ ุงููููุฉ** | I=FรH | โ ููุณ ุงูููุทู | โ 100% | ูุชุทุงุจู ุชูุงูุงู |
| **ุฅุฌูุงูู ุงููุงุฑุฏุงุช** | SUM(E:E) | โ sum(receipts) | โ 100% | ูุชุทุงุจู ุชูุงูุงู |
| **ุฅุฌูุงูู ุงูุตุงุฏุฑุงุช** | SUM(F:F) | โ sum(issues) | โ 100% | ูุชุทุงุจู ุชูุงูุงู |
| **ุงูุฑุตูุฏ ุงูููุงุฆู** | ูุญุณูุจ | โ ูุญุณูุจ | โ 100% | ูุชุทุงุจู ุชูุงูุงู |
| **ุงููุจูุบ ูุจู ุงูุถุฑูุจุฉ** | SUM(I:I) | โ IssuesรRate | โ 100% | ุฑูุงุถูุงู ูุชุทุงุจู |
| **ุถุฑูุจุฉ 15%** | ุซุงุจุช | โ ูุงุจู ููุชุนุฏูู | โ๏ธ 90% | ุงูููุฏ ุฃูุซุฑ ูุฑููุฉ |
| **ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู** | ูุฏูู | โ ูุฏูู + ูุญุณูุจ | โ 110% | ุงูููุฏ ุฃูุถู |
| **ุงูุณุนุฑ (Rate)** | ุซุงุจุช 115 | โ ูุฑุจูุท ุจู tax_rate | โ 0% | **ูุญุชุงุฌ ุฅุตูุงุญ** |
| **ุนุฑุถ ุงูููุชุฌุงุช** | ูููุตูุฉ | ูุฌููุนุฉ | โ๏ธ 50% | ูุญุชุงุฌ ุฎูุงุฑ |
| **ุชุตููุฉ ุจุงูููุชุฌ** | ูุฏูู | โ ุบูุฑ ููุฌูุฏ | โ๏ธ 50% | ููุฒุฉ ููุชุฑุญุฉ |
| **ุชูุณูู Excel** | ููุณูู | โ ููุณูู | โ๏ธ 80% | ูุญุชุงุฌ ุชุญุณูู |

**ุงููุชูุฌุฉ ุงูุฅุฌูุงููุฉ:** โ๏ธ **85% ูุชุทุงุจู**

---

## ๐ง ุงูุฌุฒุก ุงูุณุงุจุน: ุงูุฃุฎุทุงุก ุงูุชู ูุฌุจ ุฅุตูุงุญูุง

### โ ุฎุทุฃ 1: ุงูุฎูุท ุจูู Rate ู Tax Rate

**ุงูููู:** `app/Filament/Resources/CustomerResource/Pages/CustomerReport.php`  
**ุงูุณุทุฑ:** 111

**ุงูููุฏ ุงูุญุงูู:**
```php
$this->rate = ($data['tax_rate'] ?? 0) / 100 + 1;
```

**ุงููุดููุฉ:**
- ุงููุชุบูุฑ `rate` ููุณุชุฎุฏู ูุญุณุงุจ ุงููููุฉ: `value = issues ร rate`
- ููู ูุชู ุญุณุงุจู ูู `tax_rate` ููุฐุง ุฎุทุฃ ููุงูููู
- ูู Excel: Rate = 115 (ุณุนุฑ ุงููุญุฏุฉ)ุ Tax = 15% (ุถุฑูุจุฉ)

**ุงูุญู:**
```php
// ุฅุถุงูุฉ ุญูู ุฌุฏูุฏ ูู ุงูููุฑู
Forms\Components\TextInput::make('unit_rate')
    ->label('Unit Rate - ุณุนุฑ ุงููุญุฏุฉ (SAR)')
    ->numeric()
    ->default(115)
    ->required()
    ->helperText('Enter the unit price per ton'),

Forms\Components\TextInput::make('tax_rate')
    ->label('Tax Rate - ูุนุฏู ุงูุถุฑูุจุฉ (%)')
    ->numeric()
    ->default(15)
    ->step(0.01)
    ->suffix('%')
    ->helperText('Enter VAT percentage (e.g., 15 for 15%)'),

// ุชุนุฏูู ุงูุญุณุงุจ
$this->unitRate = $data['unit_rate'] ?? 115;
$this->taxRate = ($data['tax_rate'] ?? 15) / 100;

// ุงุณุชุฎุฏุงู unitRate ุจุฏูุงู ูู rate
$value = $transaction['issues'] * $this->unitRate;

// ุญุณุงุจ ุงูุถุฑูุจุฉ
$this->totalAmountBeforeTax = $this->totalIssues * $this->unitRate;
$this->vatAmount = $this->totalAmountBeforeTax * $this->taxRate;
```

---

### โ๏ธ ุชุญุณูู 1: ุนุฑุถ ุงูููุชุฌุงุช ูููุตูุฉ

**ุงููุดููุฉ:**
- Excel ูุนุฑุถ ูู ููุชุฌ ูู ุตู ูููุตู
- ุงูููุฏ ูุฌูุน ูู ููุชุฌุงุช ุงููุณุชูุฏ ูู ุตู ูุงุญุฏ

**ุงูุญู:**
```php
// ุฅุถุงูุฉ ุฎูุงุฑ ูู ุงูููุฑู
Forms\Components\Toggle::make('separate_products')
    ->label('Show products separately - ุนุฑุถ ูู ููุชุฌ ูู ุตู ูููุตู')
    ->default(false)
    ->helperText('When enabled, each product will be shown in a separate row'),

// ุชุนุฏูู ุฏุงูุฉ getTransactionsInRange
protected function getTransactionsInRange(int $customerId, Carbon $dateFrom, Carbon $dateTo): Collection
{
    $transactions = collect();
    $separateProducts = $this->data['separate_products'] ?? false;

    if ($separateProducts) {
        // ุนุฑุถ ูู ููุชุฌ ูููุตู
        $receiptDocs = ReceiptDocument::where('id_customer', $customerId)
            ->whereBetween('date_and_time', [$dateFrom, $dateTo])
            ->with(['receiptDocumentProducts.product'])
            ->get();

        foreach ($receiptDocs as $doc) {
            foreach ($doc->receiptDocumentProducts as $docProduct) {
                $transactions->push([
                    'date' => $doc->date_and_time,
                    'document_number' => $doc->document_number,
                    'product_name' => $docProduct->product->name,
                    'receipts' => $docProduct->quantity,
                    'issues' => 0,
                    'sort_date' => $doc->date_and_time,
                ]);
            }
        }
        
        // ููุณ ุงูุดูุก ููู Delivery Documents
        // ...
    } else {
        // ุงูุทุฑููุฉ ุงูุญุงููุฉ (ุชุฌููุน ุงูููุชุฌุงุช)
        // ...
    }

    return $transactions->sortBy('sort_date')->values();
}
```

---

### โ๏ธ ุชุญุณูู 2: ุชุตููุฉ ุญุณุจ ุงูููุชุฌ

**ุงูููุฒุฉ ุงูููุชุฑุญุฉ:**
- ุฅููุงููุฉ ุนูู ุชูุฑูุฑ ูููุชุฌ ูุงุญุฏ ููุท (ูุซู ASPHALT 60/70 ููุท)

**ุงูุญู:**
```php
// ุฅุถุงูุฉ ูู ุงูููุฑู
Forms\Components\Select::make('product_id')
    ->label('Filter by Product (optional) - ุชุตููุฉ ุญุณุจ ุงูููุชุฌ')
    ->options(Product::pluck('name', 'id'))
    ->searchable()
    ->nullable()
    ->helperText('Leave empty to show all products'),

// ุชุนุฏูู ุฏุงูุฉ getTransactionsInRange
protected function getTransactionsInRange(int $customerId, Carbon $dateFrom, Carbon $dateTo): Collection
{
    $productId = $this->data['product_id'] ?? null;

    $receiptQuery = ReceiptDocument::where('id_customer', $customerId)
        ->whereBetween('date_and_time', [$dateFrom, $dateTo])
        ->with(['receiptDocumentProducts.product']);
    
    if ($productId) {
        $receiptQuery->whereHas('receiptDocumentProducts', function($q) use ($productId) {
            $q->where('id_product', $productId);
        });
    }
    
    $receiptDocs = $receiptQuery->get();
    
    foreach ($receiptDocs as $doc) {
        // ุชุตููุฉ ุงูููุชุฌุงุช ุฏุงุฎู ุงููุณุชูุฏ
        $products = $doc->receiptDocumentProducts;
        if ($productId) {
            $products = $products->where('id_product', $productId);
        }
        
        $totalQty = $products->sum('quantity');
        $productNames = $products->pluck('product.name')->join(', ');
        
        // ...
    }
}
```

---

## โ ุงูุฌุฒุก ุงูุซุงูู: ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

### ุงููุทุงุจูุฉ ุงูุนุงูุฉ: โญ **85%**

### โ ูุง ูู ูุชุทุงุจู ุชูุงูุงู:
1. โ ูุนุงุฏูุฉ ุญุณุงุจ ุงูุฑุตูุฏ
2. โ ูุนุงุฏูุฉ ุญุณุงุจ ุงููููุฉ
3. โ ุฅุฌูุงูู ุงููุงุฑุฏุงุช ูุงูุตุงุฏุฑุงุช
4. โ ุญุณุงุจ ุงูุฑุตูุฏ ุงูููุงุฆู
5. โ ุญุณุงุจ ุงูุถุฑูุจุฉ 15%
6. โ ุจููุฉ ุงูุฌุฏูู (8 ุฃุนูุฏุฉ)
7. โ ุงูุฌุฏูู ุงูุฎุชุงูู (Summary)

### โ๏ธ ูุง ูุญุชุงุฌ ุฅุตูุงุญ:
1. โ **ุนุงุฌู**: ูุตู ููููู Unit Rate ุนู Tax Rate
2. โ๏ธ ุฅุถุงูุฉ ุฎูุงุฑ ุนุฑุถ ุงูููุชุฌุงุช ูููุตูุฉ
3. โ๏ธ ุฅุถุงูุฉ ุชุตููุฉ ุญุณุจ ุงูููุชุฌ
4. โ๏ธ ุชุญุณูู ุชูุณูู Excel Export ููุทุงุจู ุงููููุฐุฌ

### ๐ฏ ุงูุฃููููุงุช:
1. **ุงูุฃููููุฉ 1:** ุฅุตูุงุญ ุฎุทุฃ Rate/Tax Rate (ุนุงุฌู) โ๏ธ
2. **ุงูุฃููููุฉ 2:** ุฅุถุงูุฉ ุฎูุงุฑ ุนุฑุถ ุงูููุชุฌุงุช ูููุตูุฉ
3. **ุงูุฃููููุฉ 3:** ุฅุถุงูุฉ ุชุตููุฉ ุญุณุจ ุงูููุชุฌ
4. **ุงูุฃููููุฉ 4:** ุชุญุณูู ุชูุณูู ุงูู Export

---

## ๐ ุงูุฑุณู ุงูุชูุถูุญู

```
Excel File Structure:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Company Header                              โ
โ Product Name: ASPHALT 60/70                 โ
โ Period: 1-31 Aug 2025                       โ
โโโโโโฌโโโโโโโฌโโโโโโโโโโฌโโโโโโโโโฌโโโโโโโโโโโโโโโค
โ No โ Date โ Doc No  โ Productโ Receipts     โ
โโโโโโผโโโโโโโผโโโโโโโโโโผโโโโโโโโโผโโโโโโโโโโโโโโโค
โ 1  โ 8/2  โ REC-008 โ ASP    โ 26.02        โ
โ 2  โ 8/2  โ DEL-006 โ PG 76  โ              โ
โโโโโโดโโโโโโโดโโโโโโโโโโดโโโโโโโโโดโโโโโโโโโโโโโโโ
     โโโโโโโโโโโฌโโโโโโโฌโโโโโโโโโโ
     โ Issues  โ Bal  โ Value   โ
     โโโโโโโโโโโผโโโโโโโผโโโโโโโโโโค
     โ         โ 26.02โ         โ
     โ 25.06   โ 0.96 โ 2881.9  โ
     โโโโโโโโโโโดโโโโโโโดโโโโโโโโโโ

Current Code Structure:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Inventory Account Statement - Al-Gary      โ
โ From: 01/08/2025 To: 31/08/2025            โ
โโโโโโฌโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ No โ Date โ Doc No  โ Description          โ
โโโโโโผโโโโโโโผโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโค
โ 1  โ 8/2  โ REC-008 โ Receipt: ASP         โ
โ 2  โ 8/2  โ DEL-006 โ Delivery: PG 76      โ
โโโโโโดโโโโโโโดโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโ
     โโโโโโโโโโโฌโโโโโโโฌโโโโโโโโโโ
     โ Issues  โ Bal  โ Value   โ
     โโโโโโโโโโโผโโโโโโโผโโโโโโโโโโค
     โ         โ 26.02โ         โ
     โ 25.06   โ 0.96 โ 2881.9  โ
     โโโโโโโโโโโดโโโโโโโดโโโโโโโโโโ

โ Same calculation logic
โ๏ธ Different product grouping
โ Rate concept needs fix
```

---

**ุชู ุฅุนุฏุงุฏ ุงูุชูุฑูุฑ ุจูุงุณุทุฉ:** GitHub Copilot  
**ุงูุชุงุฑูุฎ:** 2025-10-21  
**ุงูุญุงูุฉ:** ๐ก ูุญุชุงุฌ ุฅุตูุงุญุงุช
